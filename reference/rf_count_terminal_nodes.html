<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Count the terminal nodes in each tree from a random forest — rf_count_terminal_nodes • ck37r</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">ck37r</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ck37/ck37r">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Count the terminal nodes in each tree from a random forest</h1>
    </div>

    
    <p>Returns a vector of terminal node counts for each tree in a random forest.
The distribution of terminal node counts is helpful when seeking to optimize
the maxnodes hyperparameter of the random forest. By default RF allows very
large trees, which may result in overfitting. Optimizing the number of
terminal nodes in a random forest is a more direct way of requiring simpler
trees than the minimum node size hyperparameter.</p>
    

    <pre class="usage"><span class='fu'>rf_count_terminal_nodes</span>(<span class='no'>rf</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>rf</th>
      <td><p>Random Forest object</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>vector of terminal node counts</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Breiman, L. (2001). Random forests. Machine learning, 45(1), 5-32.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='http://www.rdocumentation.org/packages/randomForest/topics/getTree'>getTree</a></code>
   <code><a href='http://www.rdocumentation.org/packages/randomForest/topics/randomForest'>randomForest</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>library</span>(<span class='no'>SuperLearner</span>)
<span class='fu'>library</span>(<span class='no'>ck37r</span>)

<span class='fu'>data</span>(<span class='no'>Boston</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"MASS"</span>)

<span class='fu'>set.seed</span>(<span class='fl'>1</span>)

<span class='co'># Downsample to 100 observations speed up example.</span>
<span class='no'>Boston</span> <span class='kw'>=</span> <span class='no'>Boston</span>[<span class='fu'>sample</span>(<span class='fu'>nrow</span>(<span class='no'>Boston</span>), <span class='fl'>100L</span>), ]

<span class='no'>sl</span> <span class='kw'>=</span> <span class='fu'>SuperLearner</span>(<span class='no'>Boston</span>$<span class='no'>medv</span>, <span class='fu'>subset</span>(<span class='no'>Boston</span>, <span class='kw'>select</span> <span class='kw'>=</span> -<span class='no'>medv</span>),
                  <span class='kw'>family</span> <span class='kw'>=</span> <span class='fu'>gaussian</span>(),
                  <span class='kw'>cvControl</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>V</span> <span class='kw'>=</span> <span class='fl'>3</span>),
                  <span class='kw'>SL.library</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"SL.mean"</span>, <span class='st'>"SL.glm"</span>, <span class='st'>"SL.randomForest"</span>))</div><div class='output co'>#&gt; <span class='message'>Loading required package: randomForest</span></div><div class='output co'>#&gt; <span class='message'>randomForest 4.6-12</span></div><div class='output co'>#&gt; <span class='message'>Type rfNews() to see new features/changes/bug fixes.</span></div><div class='input'>
<span class='no'>sl</span></div><div class='output co'>#&gt; 
#&gt; Call:  
#&gt; SuperLearner(Y = Boston$medv, X = subset(Boston, select = -medv), family = gaussian(),  
#&gt;     SL.library = c("SL.mean", "SL.glm", "SL.randomForest"), cvControl = list(V = 3)) 
#&gt; 
#&gt; 
#&gt; 
#&gt;                         Risk Coef
#&gt; SL.mean_All         82.41584    0
#&gt; SL.glm_All          55.88575    0
#&gt; SL.randomForest_All 34.87371    1</div><div class='input'>
<span class='fu'>summary</span>(<span class='fu'>rf_count_terminal_nodes</span>(<span class='no'>sl</span>$<span class='no'>fitLibrary</span>$<span class='no'>SL.randomForest_All</span>$<span class='no'>object</span>))</div><div class='output co'>#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;    26.0    32.0    33.0    33.3    35.0    41.0 </div><div class='input'>
<span class='no'>max_terminal_nodes</span> <span class='kw'>=</span>
       <span class='fu'>max</span>(<span class='fu'>rf_count_terminal_nodes</span>(<span class='no'>sl</span>$<span class='no'>fitLibrary</span>$<span class='no'>SL.randomForest_All</span>$<span class='no'>object</span>))

<span class='no'>max_terminal_nodes</span></div><div class='output co'>#&gt; [1] 41</div><div class='input'>
<span class='co'># Now run create.Learner() based on that maximum.</span>

<span class='co'># It is often handy to convert to log scale of a hyperparameter before</span>
<span class='co'># testing a ~linear grid.</span>
<span class='co'># NOTE: -0.7 ~ 0.69 ~ log(0.5) which is the multiplier that yields sqrt(max)</span>
<span class='no'>maxnode_seq</span> <span class='kw'>=</span> <span class='fu'>unique</span>(<span class='fu'>round</span>(<span class='fu'>exp</span>(<span class='fu'>log</span>(<span class='no'>max_terminal_nodes</span>) *
                               <span class='fu'>exp</span>(<span class='fu'>c</span>(-<span class='fl'>0.97</span>, -<span class='fl'>0.7</span>, -<span class='fl'>0.45</span>, -<span class='fl'>0.15</span>, <span class='fl'>0</span>)))))
<span class='no'>maxnode_seq</span></div><div class='output co'>#&gt; [1]  4  6 11 24 41</div><div class='input'>
<span class='no'>rf</span> <span class='kw'>=</span> <span class='kw'>SuperLearner</span><span class='kw'>::</span><span class='fu'>create.Learner</span>(<span class='st'>"SL.randomForest"</span>, <span class='kw'>detailed_names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
                                  <span class='kw'>name_prefix</span> <span class='kw'>=</span> <span class='st'>"rf"</span>,
                                  <span class='co'># fewer trees for testing speed only.</span>
                                  <span class='kw'>params</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>ntree</span> <span class='kw'>=</span> <span class='fl'>100</span>),
                                  <span class='kw'>tune</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>maxnodes</span> <span class='kw'>=</span> <span class='no'>maxnode_seq</span>))

<span class='no'>sl</span> <span class='kw'>=</span> <span class='fu'>SuperLearner</span>(<span class='no'>Boston</span>$<span class='no'>medv</span>, <span class='fu'>subset</span>(<span class='no'>Boston</span>, <span class='kw'>select</span> <span class='kw'>=</span> -<span class='no'>medv</span>),
                  <span class='kw'>family</span> <span class='kw'>=</span> <span class='fu'>gaussian</span>(),
                  <span class='kw'>cvControl</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>V</span> <span class='kw'>=</span> <span class='fl'>3</span>),
                  <span class='kw'>SL.library</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"SL.mean"</span>, <span class='st'>"SL.glm"</span>, <span class='no'>rf</span>$<span class='no'>names</span>))

<span class='no'>sl</span></div><div class='output co'>#&gt; 
#&gt; Call:  
#&gt; SuperLearner(Y = Boston$medv, X = subset(Boston, select = -medv), family = gaussian(),  
#&gt;     SL.library = c("SL.mean", "SL.glm", rf$names), cvControl = list(V = 3)) 
#&gt; 
#&gt; 
#&gt;                 Risk      Coef
#&gt; SL.mean_All 82.20832 0.0000000
#&gt; SL.glm_All  44.96435 0.0000000
#&gt; rf_4_All    32.67405 0.0000000
#&gt; rf_6_All    26.56812 0.0000000
#&gt; rf_11_All   23.40124 0.2861234
#&gt; rf_24_All   23.07783 0.3243657
#&gt; rf_41_All   23.10118 0.3895109</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Chris Kennedy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
